<!doctype>
<html>
<head>
  <script src="jquery-3.1.1.min.js"></script>
    <link	rel = "stylesheet"	type = "text/css"	href = "style.css">
    <link	rel = "stylesheet"	type = "text/css"	href = "gameStyles.css">
    <link rel="stylesheet" href="jquery-ui.min.css">
    <script type="text/javascript" src="model.js"> </script>
    <script src="jquery-ui.min.js"></script>
</head>
<body>
  <div class="box">
  <div class="ctn">
  <svg><filter id=cracked><feGaussianBlur stdDeviation=.5 in=SourceGraphic result=B /><feTurbulence result=T numOctaves=7 seed=488 baseFrequency=.042 /><feDisplacementMap in2=T xChannelSelector=R yChannelSelector=G in=T result=D /><feComposite in2=D operator=in in=B result=C /><feSpecularLighting in=C specularExponent=65 specularConstant=2 result=S surfaceScale=2><feDistantLight azimuth=225 elevation=62 /></feSpecularLighting><feComposite in2=C operator=arithmetic k1=2.5 k2=-.5 k3=1 in=S result=C /><feBlend in2=C mode=multiply result=A /><feColorMatrix result=fC in=A values='1 0 0 -1 0 1 0 1 -1 0 1 0 0 -1 0 -2 -0.5 0 5 -2'/><feGaussianBlur result=B in=fC stdDeviation=8 /><feOffset in=B dy=2 dx=2 /><feSpecularLighting specularExponent=15 specularConstant=.8 surfaceScale=4 result=S in=B><fePointLight z=20000 y=-10000 x=-5000 /></feSpecularLighting><feComposite in2=fC operator=in in=S result=C /><feComposite in2=C operator=arithmetic k2=2 k3=2 in=A result=C /><feBlend in2=C mode=darken /></filter>
  </svg>
  <div class="background"></div>
  <div class="welcome">
    <h1>OS CRUSH</h1>
  </div>

  <div class="android">
    <img src="images/android.png" style="width:175px;height:175px;">
  </div>

<div class="linux">
  <img src="images/linux.png" style="width:175px;height:175px;">
</div>

<div class="ubuntu">
  <img src="images/ubuntu.png" style="width:160px;height:160px;">
</div>

<div class="apple">
  <img src="images/apple.png" style="width:160px;height:160px;">
</div>

<div class="windows">
  <img src="images/windows.png" style="width:160px;height:160px;">
</div>

<div class="freebsd">
  <img src="images/freebsd.png" style="width:160px;height:160px;">
</div>

<div class="btn">
  <button onclick="showpage(2)">START GAME</button>
</div>
  </div>
  <div class="home">
    <div class="home_img">
      <img src="images/home.png" onclick="showpage(1)">
    </div>
    <div class="title">
      <h2>OS CRUSHER</h2>
      <div class="score">
        <table>
        <tr><td>SCORE: </td><td>0000</td></tr>
        </table>
      </div>
    </div>
  </div>

  <div class="mainConatiner">
    <div class="board">
      <img id="destroyer" src ="images/tornado.gif">
        <div class="sound" value="1" title="It's On!">&#x1f50a;</div>
        <button id="pausePlay" >Pause</button>
        <button id="replay" >Replay</button>

      <div class="GameBoard">
        <div class="circuit"></div>
        <div class="scoreBoard" id="scoreBoard">Score <br><span >0000</span></div>
        <div class="goalBoard" id="goalBoard">Goal: Get each OS</div>
      </div>
    </div>
  </div>
</div>
<script>
$( document ).tooltip();
$( ".sound" ).tooltip({
  classes: {
    "ui-tooltip": "highlight"
  }
});
$("h1").slideUp(100);
$("h1").slideDown(1000);
$(".btn").fadeOut(100);
$(".btn").fadeIn(1500);
var scrollSpeed = 40;
var current = 0;
var directon = "h";

$(".ctn").show();
$(".mainConatiner").hide();
$(".home").hide();

function showpage(page) {
  $(".ctn").hide();  //hide the button
  $(".mainConatiner").hide(); //hide the game itself
  $(".home").hide(); // hide the header of the game itself
  if (page === 1) {
    $(".ctn").fadeIn(900);
    animHome = setInterval("croll()", scrollSpeed);
  }
  else if (page === 2) {
   //$(".home").fadeIn(900);
  clearInterval(animHome);
    $(".mainConatiner").fadeIn(1000);
    startGame();

  }
}
//showpage(2); //////..........................
function croll() {
  current -= 1;
  $(".background").css("background-position", (directon == "h")? current + "px 0" : "0 " + current + "px");
}

var animHome=setInterval("croll()", scrollSpeed);
//game......................................................
var mySize=70;
var icons=["images/android.png","images/apple.png","images/freebsd.png","images/linux.png","images/ubuntu.png","images/windows.png"];
var pioneers=["images/gates.png","images/stevejobs.png","images/dennisritchie.png","images/linustrovals.png","images/markshuttleworth.png"],pionerWorks=[ "5","1","2","3","4"];
var gameStarted=false;
var myBonnus =false;
var score =0;

game.addListener("drawNewBox",function(top,left, type){
  var id=top+""+left+""+type, top = top*mySize, left = 7*mySize; //left allways at 6, last position
  var div =$("<div class = 'boxes' id = '"+id+"'  style = 'position:absolute; width:45px; height:45px; top:"+top+"px; left:"+left+"px;  background-image:url("+icons[type]+"); cursor:pointer;'><div>");
  $(".GameBoard").append(div);
  div.mousedown(function(e){
    e.preventDefault();
    if(gameStarted){
       game.tryMoveClick(e.target.id,e.target.className);
      if($(".aPionner").length >0){
        $(".aPionner").remove();
      }
        $(this).animate({width:"+=10",height:"+=10"},300,function(){$(this).animate({width:"-=10",height:"-=10"},100)});
   }
  });
  div.mouseup(function(e){
    e.preventDefault();
    if(gameStarted){
       game.tryMoveDrag(e.target.id,e.target.className);
    }
  });
});


game.addListener("drawGrid",function(top,left, type){
  var id=top+""+left+""+type, top = top*mySize, left = left*mySize;
  var div =$("<div class = 'boxes' id = '"+id+"'  style = 'position:absolute; width:45px; height:45px; top:"+top+"px; left:"+left+"px;  background-image:url("+icons[type]+"); cursor:pointer;'><div>");
  $(".GameBoard").append(div);
  div.mousedown(function(e){
    e.preventDefault();
    if(gameStarted){
      game.tryMoveClick(e.target.id,e.target.className);
      if($(".aPionner").length >0){
          $(".aPionner").remove();
      }
        $(this).animate({width:"+=10",height:"+=10"},300,function(){$(this).animate({width:"-=10",height:"-=10"},100)});
    }
  });
  div.mouseup(function(e){
    e.preventDefault();
    if(gameStarted){game.tryMoveDrag(e.target.id,e.target.className);}
  });
});


game.addListener("deleted",function(ids,bonnus,effect1){
  myBonnus=bonnus;
for(var i=0; i< ids.length; i++){
    var top = parseInt($("#"+ids[i]).css("top"));
    var left = parseInt($("#"+ids[i]).css("left"));
    var type =ids[i].charAt(2);
    if(effect1){
      blastAll(top,left,$("#"+ids[i]));
    }
    else {
      $("#"+ids[i]).css({"background-image":"url(images/gif.gif)"});
      $("#"+ids[i]).animate({width:"+=30px",height:"+=30px",top:"-=10px"},100,function(){$(this).animate({width:"-=30px",height:"-=30px",top:"+=10px",left:"+=5px"},100,function(){$(this).css({"background-image":"url(images/e.png)"});})});
    }
    var bubbles = $("<p class ='bubbles' style ='position:absolute; width: 50px; height: 50px; top:"+top+"px; left:"+left+"px; color: white; font-size: 2em;'>+30</p>");
    $(".GameBoard").append(bubbles);
    bubbles.animate({top: "217px",left:"525px",fontSize:".5em"},700,function(){$(this).css({"font-size":".5em"}); $(this).remove(); treeAbsord(type,bonnus);});
    debri(top,left);
 }
 var t=700;
 if(!effect1){t=700;}
 setTimeout(function(){
    for(var i=0; i< ids.length; i++){
      $("#"+ids[i]).remove();
    }
    game.deleteDone(ids);
 },t);
 myBonnus=[];
});


game.addListener("updateABox", function(id,del,top,left){
   $("#"+id).animate({
      top: top*mySize,
      left: left*mySize
   },300,function(){
    // debri(parseInt($(this).css("top")),parseInt($(this).css("left")));
    // console.log($(this).css("top"));
    //  $("#"+id).animate({top:"+=15px"},100,function(){ $("#"+id).animate({top:"-=15px"},100);  });
   });

});



game.addListener("pioneer",function(who){
 if(gameStarted){
   if($("#aPionner").length >0){
      return;
    }
    var pioneerImage=$("<div class='aPionner'  id ='aPionner' style ='position:absolute; top:370px; left:600px; cursor:pointer;'><img  src='images/eco.png' style='width:90px; height: 90px; '><img src= "+icons[who]+" style=' width:20px; height: 20px; position:absolute; top:35px; left:35px; cursor:pointer;'></div>");
    $(".board").append(pioneerImage);
    pioneerImage.click(function(){
      if(gameStarted){
        this.remove();
        //console.log();
        game.deleteAll(who.toString());
      }
    });
 }
});

game.addListener("troy",function(p){
  if(gameStarted){
    if($(".destroyer2").length > 0){
      return;
    }
    var img =$("<img class='destroyer2' src='images/e1.png'>");
    $(".board").append(img);
    img.animate({top:200,left:570},300);
    img.click(function(){
      var rand=Math.floor((Math.random() * 6) + 0);
      troy(rand);
      img.remove();
    });
  }
});

function debri(top,left){
top =top -25;
for(var i =0; i<10; i++){
var rand=Math.floor((Math.random() * 4) + 0);
top=top+2;
var bubbles = $("<p class ='' style ='position:absolute; width: 10px; height: 10px; top:"+top+"px; left:"+left+"px; color: blue;'>...</p>");
$(".GameBoard").append(bubbles);
 bubbles.animate({
  left:"-500px"
},i*100+500,function(){
   $(this).remove();

 });
}
}


function blastAll(top,left,callBAck,callBAck2){
var start =$("<img ></img>");
var elt=$("<div class='bullet'  style='position: absolute; top:190px; left:600px; z-index:11; '><img src='images/light.png' alt='' style=' width:70px; height:70px; '></div>");
$(".GameBoard").append(elt);
elt.animate({
top:top,
left:left
},500,function(){
$(this).remove();
callBAck.css({"background-image":"url(images/gif.gif)"});
callBAck.animate({width:"+=30px",height:"+=30px",top:"-=10px"},100,function(){$(this).animate({width:"-=30px",height:"-=30px",top:"+=10px",left:"+=5px"},100,function(){$(this).css({"background-image":"url(images/e.png)"});})});
});
}

function treeAbsord(type, bonus){
  if(gameStarted){
    var elt0=$("<img src='images/light.png' alt='' style=' position: absolute; top:"+217+"px; left:"+555+"px;width:30px; height:30px; '>");
    $(".GameBoard").append(elt0);
    elt0.animate({
    width:"+=20",
    height:"+=20",
    left:"+=55",
    top: "-=7"
    },1000,function(){
    if(bonus && gameStarted){
      for(var i=0; i< bonus.length; i++){
        if(bonus[i].type === type){
           var elt1=$("<div class='capturedOs' id ='capOs"+type+"' style='position: absolute; top:"+(217-7)+"px; left:"+(555+55)+"px; '><img  src='"+icons[type]+"' alt='' style='  width:30px; height:30px; '></div>");
           var span =$("<span style='position:absolute; top:25px; left:10px; color:white;'></span>");
          //  console.log(parseInt($(".goalBoard").css("top")));//+45
          //  console.log(); //+70
           var topValueNow=(parseInt($(".goalBoard").css("top"))-45)+(type*30);
           elt1.animate({left:parseInt($(".goalBoard").css("left"))+70,top: topValueNow},700,function(){
             span.animate({
               fontSize:"+=10"},300,function(){
                 $(this).animate({fontSize:"-=10"},30);});
          });
          if($("#capOs"+type).length>0){
            var oldValue = parseInt($("#capOs"+type+" span").html());
            $("#capOs"+type).remove();
            span.append(oldValue+1);
            elt1.append(span);
            $(".GameBoard").append(elt1);
            //setTimeout(function(){elt1.remove();},0);
          }else {
            span.append(1);
            elt1.append(span);
             $(".GameBoard").append(elt1);
          }
          bonus[i].type=false;
        }
      }
    }
    $(this).animate({
      left:parseInt($(".scoreBoard").css("left"))+90,
      top: $(".scoreBoard").css("top")
    },300,function(){
      $(this).remove();
      if(gameStarted){
        score+=3*30;
        $(".scoreBoard span").html(score);
        $(".scoreBoard").animate({top: "-=5"},50,function(){  $(this).animate({top: "+=5"},10);});
      }
    })});
  }
}


//$(".test").click(function(){$(".board").show();});
$("#pausePlay").click(function(e){
    var t, l, wh,icon,opa, word;
    if(gameStarted){
      t = 370; l= 190; wh ="+=50"; icon="images/play.png"; opa=.5, te=500,word="Resume";
      $('#replay').prop('disabled', true);
      var info= $("<div class='info'></div>");
      pauseGame();
    }else {
      t = 220; l= -255; wh = "-=50"; icon="images/pause.png"; opa="1",te=300, word="Pause";
        $('#replay').prop('disabled', false);
      startGame();
    }
    $(this).animate({
      top:t,
      left: l,
      width: wh,
      height:wh
    },te,function(){
      $(".GameBoard").css({"opacity":opa});
      $(this).html(word);
    });

});

$("#replay").click(function(){
  score=0;
  $(".scoreBoard span").html("0000");
  $(".boxes").remove();
  $(".destroyer2").remove();
  $(".aPionner").remove();
  $(".capturedOs").remove();
  game.initialize();
});
function startGame(){
    gameStarted=true;
  // setTimeout(function(){
  //   gameStarted=true;
  //   troy(0);
  // },5000);
}

function pauseGame(){
  gameStarted=false;
}

$(".sound").click(function(e){
  $(this).empty();
  if($(this)[0].attributes.value.value==="1"){
      $(this).append("&#x1f507;");
      $(this)[0].attributes.value.value=0;
        $( ".sound").tooltip( "option", "content", "It's Off!" );
  }else {
    $(this).append("&#x1f50a;");
    $(this)[0].attributes.value.value=1;
    $( ".sound").tooltip( "option", "content", "It's On!" );

  }
});

var dt =["-=100","-=89","-=54","+=100","-=160","+=200","+=200","-=250","+=300"];
var dl =["+=160","+=300","+=230","+=270","+=400","+=340","-=150","+=250","-=90"];

function troy(row){
  if(row<=6 && row >=0){
    var p_top = 600 - (row*70);
    $("#destroyer").show();
    $("#destroyer").animate({top:p_top,left:"0px"},300,function(){royer(0,10,100,6,0);});
    function royer(top,left,t,rep,rep2){
      $("#destroyer").animate({left:left},t,
        function(){
          var id=(game.getGridIndex(rep2,row));
          $("#"+id).css({"background-image":"url(images/arcturus.png)","z-index":"10"});
          var rand=Math.floor((Math.random() * 8) + 0);
          var rand2=Math.floor((Math.random() * 8) + 0);
          $("#"+id).animate({top:dt[rand], left: dl[rand2]},300);
          rep--; rep2++;
          if(rep===-1){
            setTimeout(function(){game.destroyGridIndex(row);},1000);
            $("#destroyer").animate({top:p_top,left:"0px"},300,function(){ $(this).hide();});
            return;}
          royer(top,left+70,t,rep,rep2);
          console.log("again");
      });
    }
  }else {
    console.log("row does not exist");
  }
}

game.initialize();


var rand=Math.floor((Math.random() * 6) + 0);
console.log(rand);
  </script>
</body>
</html>
