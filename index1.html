<!doctype>
<html>
<head>
  <script src="jquery-3.1.1.min.js"></script>
    <link	rel = "stylesheet"	type = "text/css"	href = "style.css">
    <script type="text/javascript" src="osCrush2.js"> </script>
<svg><filter id=cracked><feGaussianBlur stdDeviation=.5 in=SourceGraphic result=B /><feTurbulence result=T numOctaves=7 seed=488 baseFrequency=.042 /><feDisplacementMap in2=T xChannelSelector=R yChannelSelector=G in=T result=D /><feComposite in2=D operator=in in=B result=C /><feSpecularLighting in=C specularExponent=65 specularConstant=2 result=S surfaceScale=2><feDistantLight azimuth=225 elevation=62 /></feSpecularLighting><feComposite in2=C operator=arithmetic k1=2.5 k2=-.5 k3=1 in=S result=C /><feBlend in2=C mode=multiply result=A /><feColorMatrix result=fC in=A values='1 0 0 -1 0 1 0 1 -1 0 1 0 0 -1 0 -2 -0.5 0 5 -2'/><feGaussianBlur result=B in=fC stdDeviation=8 /><feOffset in=B dy=2 dx=2 /><feSpecularLighting specularExponent=15 specularConstant=.8 surfaceScale=4 result=S in=B><fePointLight z=20000 y=-10000 x=-5000 /></feSpecularLighting><feComposite in2=fC operator=in in=S result=C /><feComposite in2=C operator=arithmetic k2=2 k3=2 in=A result=C /><feBlend in2=C mode=darken /></filter></svg>
</head>
<body>
  <!-- <script>
  $(document).ready(function() {
    // $("h1").slideUp(100);
    // $("h1").slideDown(1000);

    // $("h1").animate({fontSize: "2em"});
    // $("h1").fadeIn(100);
    // $("h1").fadeOut(100);
    // $("h1").fadeIn(100);
    // $("h1").fadeOut(100);
    // $("h1").fadeIn(100);
    // $("h1").animate({fontSize: "3em"});
    // $("h1").animate({fontSize: "2em"});
    $(".btn").fadeOut(100);n
    $(".btn").fadeIn(1500);
  });
  </script> -->
  <div class="box">
  <div class="ctn">
  <div class="background">
  </div>

<audio src="crush.mp3" autoplay="autoplay"></audio>

    <div class="welcome">
      <h1>OS CRUSHER</h1>
    </div>

    <div class="android">
      <img src="android.png" style="width:175px;height:175px;">
    </div>

    <div class="linux">
      <img src="linux.png" style="width:175px;height:175px;">
    </div>

    <div class="ubuntu">
      <img src="ubuntu.png" style="width:160px;height:160px;">
    </div>

    <div class="apple">
      <img src="apple.png" style="width:160px;height:160px;">
    </div>

    <div class="windows">
      <img src="Windows.png" style="width:160px;height:160px;">
    </div>

    <div class="freebsd">
      <img src="freebsd.png" style="width:160px;height:160px;">
    </div>

    <div class="btn">
      <button onclick="showpage(2)">START GAME</button>
    </div>
  </div>
  <div class="home">
    <div class="home_img">
      <img src="home.png" onclick="showpage(1)">
    </div>
    <div class="title">
      <h2>OS CRUSHER</h2>
      <div class="score">
        <table>
        <tr><td>SCORE: </td><td>0000</td></tr>
        </table>
      </div>
    </div>
  </div>

  <div class="mainConatiner">
    <div class="board">
      <div class="header">
      <div class="sound" value="1">&#x1f50a;</div>
      </div>
      <div class="gameBoard" >
        <div class="colum" id="c1"></div>
        <div class="colum" id="c2"></div>
        <div class="colum" id="c3"></div>
        <div class="colum" id="c4"></div>
        <div class="colum" id="c5"></div>
        <div class="colum" id="c6"></div>
        <div class="colum" id="c7"></div>
        <div class="colum" id="c8"></div>
      </div>
    </div>
  </div>
</div>
<script>
  $("h1").slideUp(100);
  $("h1").slideDown(1000);
  $(".btn").fadeOut(100);
  $(".btn").fadeIn(1500);
  var scrollSpeed = 40;
  var current = 0;
  var directon = "h";
  function croll() {
    current -= 1;
    $(".background").css("background-position", (directon == "h")? current + "px 0" : "0 " + current + "px");
  }
  setInterval("croll()", scrollSpeed);

  $(".ctn").show();
$(".mainConatiner").hide();
$(".home").hide();
function showpage(page) {
  $(".ctn").hide();
  $(".mainConatiner").hide();
  $(".home").hide();
  if (page === 1) {
    $(".ctn").fadeIn(900);
  }
  else if (page === 2) {
    $(".home").fadeIn(900);
    $(".mainConatiner").fadeIn(1000);

  }
}

var size=30;
var cellsSize=50;
var startPointLeft=false;
var startPointTop=false;
var endPointTop=false;
var endPointLeft=false;
var iconArray=osCrush.getIconArray();
var boardColumns=["c1","c2","c3","c4","c5","c6","c7","c8"];
var iconArray=["android.png","apple.png","freebsd.png","linux.png","ubuntu.png","windows.png"];
          osCrush.addListener("gridListener", function(){
            $($(".gameBoard")[0].childNodes).empty();
            for(var i =0; i<osCrush.grid.length; i++){
            for(var j =0; j<osCrush.grid[i].length; j++){
              var elt =parseInt(osCrush.grid[i][j]);
              var t=j*cellsSize, l=i*cellsSize ;
              if(elt===-1){
                $("#"+boardColumns[i]).append("<div class='cellsTodelete' style='position: absolute; top:"+t+"px; left:"+l+"px;' value="+elt+"> <img class='cellsImg'   draggable='true' ondrop='drop(event)' ondragover='allowDrop(event)' src='gif.gif' alt=''style='width:inherit; height:inherit;' value="+elt+"> </div>");
              }
              else if(elt===0){
                $("#"+boardColumns[i]).append("<div class='cells' style='position: absolute; top:"+t+"px; left:"+l+"px;' value="+elt+"> <img class='cellsImg'   draggable='true' ondrop='drop(event)' ondragover='allowDrop(event)' src="+iconArray[elt]+" alt='' value="+elt+"> </div>");
              }else if (elt===1) {
                $("#"+boardColumns[i]).append("<div class='cells' style='position: absolute; top:"+t+"px; left:"+l+"px;' value="+elt+"> <img class='cellsImg'  draggable='true' ondrop='drop(event)' ondragover='allowDrop(event)'src="+iconArray[elt]+" alt=''value="+elt+"> </div>");
              }else if (elt===2) {
                 $("#"+boardColumns[i]).append("<div class='cells' style='position: absolute; top:"+t+"px; left:"+l+"px;' value="+elt+"> <img class='cellsImg'   draggable='true' ondrop='drop(event)' ondragover='allowDrop(event)'src="+iconArray[elt]+" alt='' value="+elt+"> </div>");
              }else if (elt===3) {
                 $("#"+boardColumns[i]).append("<div class='cells' style='position: absolute; top:"+t+"px; left:"+l+"px;' value="+elt+"> <img class='cellsImg'   draggable='true' ondrop='drop(event)'ondragover='allowDrop(event)' src="+iconArray[elt]+" alt='' value="+elt+"> </div>");
              }else if (elt===4) {
                 $("#"+boardColumns[i]).append("<div class='cells' style='position: absolute; top:"+t+"px; left:"+l+"px;' value="+elt+"> <img class='cellsImg'   draggable='true' ondrop='drop(event)'ondragover='allowDrop(event)' src="+iconArray[elt]+" alt='' value="+elt+"> </div>");
              }else if (elt===5) {
                 $("#"+boardColumns[i]).append("<div class='cells' style='position: absolute; top:"+t+"px; left:"+l+"px;' value="+elt+"> <img class='cellsImg'   draggable='true' ondrop='drop(event)'ondragover='allowDrop(event)' src="+iconArray[elt]+" alt='' value="+elt+"> </div>");
              }

            }
          }
        });
function Target(){
this.id=false;
this.id_temp=false;
this.top=false;
this.left=false;
this.id2=false;
this.id_string=false;
this.id_up=false;
this.target=false;
this.set =function(e){
this.top =parseInt($(e.target.offsetParent).css("top"));
this.left =parseInt($(e.target.offsetParent).css("left"));
this.id_string=($(e.target).parents()[1].id); //.....
this.id=($(e.target).parents()[0]);
this.id_temp=($(e.target).parents()[0]);
var elt_position=(parseInt($($(e.target).parents()[0]).css("top"))/50);
this.id2= ($($(e.target).parents()[1])[0].children[elt_position+1]);
this.id_up= ($($(e.target).parents()[1])[0].children[elt_position-1]);
};
}
var myFirst_target= new Target();

var condition_first=true;
var first_target=false;
var second_target=false;
var mouse_down_trigered=false;

          $(".gameBoard").mousedown(function(e){
            if(e.target.localName==="img"){
              if(condition_first){
                first_target=e;
                d3.selectAll("p")
                  .data([4, 8, 15, 16, 23, 42, 80])
                    .style("font-size", function(d) { return d + "px"; });
                myFirst_target.set(e);
                condition_first=false;
              }else {
                //then second condition, second click
                second_target=e;
                flip_with_FirstTrarget(myFirst_target,e);
                updateGrid();
                if(!osCrush.checkGrid("just_simulation")){
                  setTimeout(function(){similation_failed();},250);
                }
                condition_first=true;
              }
            }else {
              console.log("error");
            }
          });


          function drop(e) {
            condition_first=true;
            if(e.target.localName ==="img"){
              second_target=e;
            flip_with_FirstTrarget(myFirst_target,e);
             updateGrid();
            if(!osCrush.checkGrid("just_simulation")){
              setTimeout(function(){similation_failed();},250);
            }
           }else {
             console.log('error');
           }
          }

function flip_with_FirstTrarget(targetA,e){
var diff_top =Math.abs(targetA.top-parseInt($(e.target.offsetParent).css("top")));
var diff_left =Math.abs(targetA.left-parseInt($(e.target.offsetParent).css("left")));
if((diff_top!==50 && diff_top!==0) ){condition_first=true;return ;}
if((diff_top===50 && diff_left!==0) ){condition_first=true;return ;}
if((diff_left!==50 && diff_left!==0)){condition_first=true;return ;}
var this_target_id=$(e.target).parents()[1].id;///return something like c8 or c1
if(targetA.id_string !== this_target_id){
$($(e.target.offsetParent)).before($(targetA.id));
if(!targetA.id2){
$($("#"+targetA.id_string)).append($(e.target.offsetParent));
}else {
$($(targetA.id2)).before($(e.target.offsetParent));
}
var tp =($(e.target.offsetParent).css("top"));
var lt =($(e.target.offsetParent).css("left"));
$(targetA.id).css("top",tp);
$(targetA.id).css("left",lt);
$(e.target.offsetParent).css("top",targetA.top);
$(e.target.offsetParent).css("left",targetA.left);
}else {
var diff_top =(parseInt($(e.target.offsetParent).css("top"))-targetA.top);
if(diff_top>0){
  $($(e.target.offsetParent)).after($(targetA.id));
}else {
  $($(e.target.offsetParent)).before($(targetA.id));
}
var tp =($(e.target.offsetParent).css("top"));
var lt =($(e.target.offsetParent).css("left"));
$(targetA.id).css("top",tp);
$(targetA.id).css("left",lt);
$(e.target.offsetParent).css("top",targetA.top);
$(e.target.offsetParent).css("left",targetA.left);
}
}

          function allowDrop(event) {
             event.preventDefault();
          }
          $(".sound").click(function(){
            //osCrush.checkGrid();
            similation_failed();
            $(this).empty();

            if($(this)[0].attributes.value.value==="1"){
                $(this).append("&#x1f507;");
                $(this)[0].attributes.value.value=0;
            }else {
              $(this).append("&#x1f50a;");
              $(this)[0].attributes.value.value=1;
            }
          });
osCrush.initialize();

function dropAll_from(i,elts,count){
for(var y=0; y<elts.length; y++){
if(elts[y].attributes.value.value !=="-1"){
  var nextPosition=(parseInt($(elts[y]).css("top"))+(50));
  $(elts[y]).css("top",nextPosition);

}else {

  return;
}

}
}
function addOne_top(where){
var rand=Math.floor((Math.random() * 6) + 0);
$("#"+boardColumns[where]).prepend("<div class='cells' style='position: absolute; top:"+0+"px; left:"+where*50+"px;' value="+rand+"> <img class='cellsImg'   draggable='true' ondrop='drop(event)' ondragover='allowDrop(event)' src="+iconArray[rand]+" alt='' value="+rand+"> </div>");
}
function dropAnime1(){
for(var i=0; i<osCrush.grid.length; i++){
var elts=$("#"+boardColumns[i])[0].childNodes;
var count =0;
for(var j =0; j<elts.length; j++){
    if(elts[j].attributes.value.value ==="-1" ){
      dropAll_from(i,elts,count);
      $(elts[j]).remove();
      addOne_top(i);
      break;
    }else {
      //dropAll_from(elts,count);
    }
}
 //return ;
}
}

function updateGrid(){
for(var i =0; i<osCrush.grid.length; i++){
var elts1=$("#"+boardColumns[i])[0].childNodes;
for(var j =0; j<elts1.length; j++){
  //console.log(elts1[j].attributes.value);
  osCrush.grid[i][j]=elts1[j].attributes.value.value;
}
}

}
function test(){
$("#test").empty();
for(var i =0; i<osCrush.grid.length; i++){
for(var j =0; j<=osCrush.grid[i].length; j++){
  var c =document.getElementById("test");
  if(j===osCrush.grid[i].length){
    c.innerHTML+= "<br>";
  }else {
      c.innerHTML+= osCrush.grid[i][j];
  }
}
}
}
function similation_failed(){
if(first_target && second_target){
myFirst_target.set(first_target); //setting target back to the first clicked;
flip_with_FirstTrarget(myFirst_target,second_target);
//   $(first_target.target).trigger( "mousedown" );
//  setTimeout(function(){$(second_target.target).trigger( "mousedown" );},100);

}else {
console.log("no target yet");
}


}

var interval =setInterval(function(){
dropAnime1();
updateGrid();
osCrush.checkGrid();
test();
},250);
//osCrush.checkGrid();

  </script>
</body>
</html>
